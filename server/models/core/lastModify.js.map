{"version":3,"file":"lastModify.js","sourceRoot":"","sources":["../../../serverTs/models/core/lastModify.ts"],"names":[],"mappings":";;AAaA,MAAM,CAAC,OAAO,GAAG,OAAO,GAAG,4BAA6B,MAAsB,EAAE,OAAqB;IACnG,MAAM,CAAC,GAAG,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAA;IAE7B,OAAO,CAAC,GAAG,CAAC,GAAG,EAAC,IAAI,CAAC,CAAA;IACrB,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,UAA2B,IAAI;QAChD,OAAO,CAAC,GAAG,CAAC,KAAK,EAAC,IAAI,CAAC,CAAA;QACvB,IAAI,CAAC,OAAO,GAAG,IAAI,IAAI,CAAA;QACvB,IAAI,EAAE,CAAA;IACR,CAAC,CAAC,CAAA;IAEF,EAAE,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;QAC7B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;IAC7C,CAAC;AACH,CAAC,CAAA","sourcesContent":["// lastMod.ts 为集合添加自动更新时间\r\nimport * as mongoose from 'mongoose'\r\n\r\ninterface PluginOptions {\r\n  lastMod?: Date,\r\n  index?: boolean,\r\n  mongoose?: typeof mongoose\r\n}\r\n\r\ninterface newDocument extends mongoose.Document {\r\n  lastMod?: Date,\r\n}\r\n\r\nmodule.exports = exports = function lastModifiedPlugin (schema:mongoose.Schema, options:PluginOptions)  {\r\n  schema.add({ lastMod: Date })\r\n\r\n  console.log('2',this)\r\n  schema.pre('save', function (this:newDocument,next) {\r\n    console.log('111',this)\r\n    this.lastMod = new Date\r\n    next()\r\n  })\r\n\r\n  if (options && options.index) {\r\n    schema.path('lastMod').index(options.index)\r\n  }\r\n}"]}